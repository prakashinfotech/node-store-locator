<div class="card">
  <div class="card-body">
    <h5 class="card-title"><%=title%> - Search businesses</h5>
    <table id="store_list" class="table table-striped table-bordered">
      
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Category</th>
          <th>Photo</th>
          <th>Address</th>
          <th>Action</th>
        </tr>
      </thead>
      <!-- <tbody>
        <% for(i=0; i<storeList.length; i++) { %>
          <tr>
            <td><%=(i+1)%></td>
            <td><%=storeList[i].name%></td>
            <td><%=storeList[i].category%></td>
            <td> <img src="<%=storeList[i].photo%>" width="250" height="250" alt="Store Photo" /> </td>
            <td><%=storeList[i].address%></td>
            <td>
              <a class="btn" href="/store/detail/<%=storeList[i].ID%>"><i class="fas fa-eye"></i></a>
              <a class="btn" href="/store/update/<%=storeList[i].ID%>"><i class="fas fa-edit"></i></a>
              <button type="button" class="btn" onclick='deleteAction("<%=storeList[i].ID%>")'><i class="fas fa-trash"></i></button>
            </td>
          </tr>
        <%}%>
      </tbody> -->
      <tfoot>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Category</th>
          <th>Photo</th>
          <th>Address</th>
          <th>Action</th>
        </tr>
      </tfoot> 
    </table>
  </div>
</div>

  <script src="/js/bootbox.min.js"></script>
  <script>
    jQuery( document ).ready(function($) {
      console.log("ready!");
      $('#store_list').DataTable({
        "processing": true,
        "serverSide": true,
        "saveState": true,
        "ajax":  {
          url: "/store/list-store-ajax",
          method: 'GET',
        },
        "lengthMenu": [[5, 10, 25, 50], [5, 10, 25, 50]],
        "responsive": true,
        "columns": [
            {"data": "recNo"},
            {"data": "name"},
            {"data": "category"},
            {"data": "photo_url"},
            {"data": "address"},
            {"data": "actions"}
        ],
        // select: true,
        // buttons: [
        //     { extend: "create", editor: editor },
        //     { extend: "edit",   editor: editor },
        //     {
        //         extend: "remove",
        //         editor: editor,
        //         formMessage: function ( e, dt ) {
        //             var rows = dt.rows( e.modifier() ).data().pluck('first_name');
        //             return 'Are you sure you want to delete the entries for the '+
        //                 'following record(s)? <ul><li>'+rows.join('</li><li>')+'</li></ul>';
        //         }
        //     }
        // ]
      });
    });

    function deleteAction(rec) {
      console.log(`Rec ${rec}`);
      bootbox.confirm({
          message: "Are you sure you want to delete this?",
          buttons: {
              confirm: {
                  label: 'Yes',
                  className: 'btn-success'
              },
              cancel: {
                  label: 'No',
                  className: 'btn-danger'
              }
          },
          callback: function (result) {
            if (result) {
              $.ajax({
                method: "GET",
                url: `/store/delete/${rec}`,
                dataType: "script",
                async : false,
              });
            } else {

            }
              console.log('This was logged in the callback: ' + result);
          }
      });
    }
    
  </script>
